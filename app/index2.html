<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Person CRUD Test</title>
</head>
<body>
    <h1>Person CRUD Test</h1>

    <!-- Form -->
    <div>
        <h2>Person Form</h2>
        <label>ID: <input type="text" id="id" placeholder="자동 생성"></label><br>
        <label>Name: <input type="text" id="name"></label><br>
        <label>Age: <input type="text" id="age"></label><br>
        <label>Address: <input type="text" id="address"></label><br>
        <label>Weight: <input type="number" id="weight"></label><br><br>

        <button onclick="createPerson()">Create (PersonDetail)</button>
        <button onclick="readPerson()">Read (Person)</button>
        <button onclick="updatePerson()">Update (Person)</button>
        <button onclick="deletePerson()">Delete (Person)</button>
        <button onclick="clearForm()">Clear</button>
    </div>

    <!-- Response -->
    <div>
        <h2>Response</h2>
        <pre id="response"></pre>
    </div>

    <!-- Table -->
    <div>
        <h2>Person List</h2>
        <table border="1" id="PersonTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Age</th>
                    <th>Address</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="PersonBody"></tbody>
        </table>
    </div>

    <script>
        const BASE_URL = 'http://localhost:4004/person';

        // CREATE - PersonDetail
        async function createPerson() {
            const data = {
                name: document.getElementById('name').value,
                age: document.getElementById('age').value,
                address: document.getElementById('address').value,
                weight: parseInt(document.getElementById('weight').value)
            };

            try {
                const response = await fetch(`${BASE_URL}/PersonDetail`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                document.getElementById('response').textContent = JSON.stringify(result, null, 2);
                
                if (response.ok) {
                    alert('Person created successfully!');
                    readPerson();
                    clearForm();
                }
            } catch (error) {
                document.getElementById('response').textContent = 'Error: ' + error.message;
            }
        }

        // READ - Person
        async function readPerson() {
            try {
                const response = await fetch(`${BASE_URL}/Person`);
                const result = await response.json();
                
                document.getElementById('response').textContent = JSON.stringify(result, null, 2);
                
                // Update table
                const tbody = document.getElementById('PersonBody');
                tbody.innerHTML = '';
                
                if (result.value && result.value.length > 0) {
                    result.value.forEach(person => {
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${person.ID}</td>
                            <td>${person.name}</td>
                            <td>${person.age}</td>
                            <td>${person.address}</td>
                            <td>
                                <button onclick='selectPerson(${JSON.stringify(person)})'>Select</button>
                                <button onclick='deletePerson("${person.ID}")'>Delete</button>
                            </td>
                        `;
                    });
                }
            } catch (error) {
                document.getElementById('response').textContent = 'Error: ' + error.message;
            }
        }

        // UPDATE - Person
        async function updatePerson() {
            const id = document.getElementById('id').value;
            
            if (!id) {
                alert('Please select a person or enter ID');
                return;
            }

            const data = {
                name: document.getElementById('name').value,
                age: document.getElementById('age').value,
                address: document.getElementById('address').value
            };

            try {
                const response = await fetch(`${BASE_URL}/Person(${id})`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                document.getElementById('response').textContent = JSON.stringify(result, null, 2);
                
                if (response.ok) {
                    alert('Person updated successfully!');
                    readPerson();
                }
            } catch (error) {
                document.getElementById('response').textContent = 'Error: ' + error.message;
            }
        }

        // DELETE - Person
        async function deletePerson(id) {
            const personId = id || document.getElementById('id').value;
            
            if (!personId) {
                alert('Please select a person or enter ID');
                return;
            }

            if (!confirm('Are you sure you want to delete this person?')) {
                return;
            }

            try {
                const response = await fetch(`${BASE_URL}/Person(${personId})`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    document.getElementById('response').textContent = 'Person deleted successfully';
                    alert('Person deleted successfully!');
                    readPerson();
                    clearForm();
                } else {
                    const result = await response.json();
                    document.getElementById('response').textContent = JSON.stringify(result, null, 2);
                }
            } catch (error) {
                document.getElementById('response').textContent = 'Error: ' + error.message;
            }
        }

        // Select person from table
        function selectPerson(person) {
            document.getElementById('id').value = person.ID;
            document.getElementById('name').value = person.name;
            document.getElementById('age').value = person.age;
            document.getElementById('address').value = person.address;
        }

        // Clear form
        function clearForm() {
            document.getElementById('id').value = '';
            document.getElementById('name').value = '';
            document.getElementById('age').value = '';
            document.getElementById('address').value = '';
            document.getElementById('weight').value = '';
        }

        // Load data on page load
        window.onload = function() {
            readPerson();
        };
    </script>
</body>
</html>